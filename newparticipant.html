<!DOCTYPE html>
<html>

<head>
	<link rel = "stylesheet" type = "text/css" href = "css/style.css">
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.1/jquery.min.js"></script>
	<!-- Latest compiled and minified CSS -->
	<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
	<link href="https://fonts.googleapis.com/css?family=Iceland" rel="stylesheet">
</head>
<style>
#remove_btn {
	visibility: hidden;
}

.person:hover #remove_btn {
	visibility: visible;
}


/*Add Expense Stylesheet*/


#add_btn {
	border-radius: 5px;
	background-color: lightblue;
	color: black;
}

#minus_btn {
	border-radius: 5px;
	background-color: salmon;
	color: black;
}

#minus_btn:disabled {
    opacity: 0.8;
}

#grandTotal {
	font-style: bold;
}

.price {
	text-align: center;
	font-size: 14px;
}

tfoot {
	background-color: grey;
	color: white;
}

tfoot #btn_row {
	background-color: black;
}

.delete_btn {
	border-radius: 5px;
	background-color: salmon;
	color: white;
	font-size: 8px;
}

</style>

<body>
	<div class = "bodyBox">
		<h4>----------------------------</h4>
		<h1 id = "title">SplitTab</h1>
		<h4>----------------------------</h4>

		<h3>Restaurant Name</h3>
		<input type="text" placeholder="Junior's Cheesecake" value="" id ="restaurant_name" autofocus></input>
		<h4>--------------------------------------------------------</h4>
		<h3>Please Enter Particpants Name</h3>

		<div id="person_list"></div>

		<button id = "new_person_btn" type="button">+ Add new person</button>
		<h4>--------------------------------------------------------</h4>
		<button id = "done_btn" type="button">Done</button>
		<h4>Thank You</h4>
	</div>

	<div class = "bodyBox" id = "addExpenseRecipt">
		<h4>----------------------------</h4>
		<h1 id ="restaurant"></h1>
		<h4>----------------------------</h4>
		<!--	<span class="glyphicon glyphicon-plus-sign" id="add_participant" style="color:green;" aria-hidden="true"></span> -->
		<div id = "participants_list"></div>


		
		<!--add Expense Table-->

	Tax %: <input type="number" step="0.125" id="taxPercent" value="8.875" max="25" min="0" style="width: 54px;" onchange="calculateAll()"/>
	<br>
	Tip %: &nbsp;<input  type="number" step="1" id="tipPercent" value="15" max="100" min="0" style="width: 53px;" onchange="calculateAll()"/>
	<br><br>

	<table border = "1" id = "myTable">
		<thead>
			<tr>
				<th width="100px" id="expense">Expense</th>
				<th>Cost</th>
				<th class="person">Split</th>
			</tr>
		</thead>
		<tfoot>
			<tr id="btn_row">
				<td colspan="3"style="text-align:right;"><button id="add_btn" type="button">Add Expense</button>
					<button id = "minus_btn" type="button" disabled>Remove Expense</button></td>
			</tr>
			<tr>
				<td>Total</td>
				<td><div id="total">0.00</div></td>
			</tr>
			<tr>
				<td>Tax</td>
				<td><div id="tax">0.00</div></td>
			</tr>

			<tr>
				<td>Tip</td>
				<td><div id="tip">0.00</div></td>
			</tr>	
			<tr>
				<td>Grand Total</td>
				<td><div id="grandTotal">$0.00</div></td>
			</tr>
		</tfoot>

		<tbody>
		</tbody>
	</table>

	</div>

	<script>

	//ENTER PARTICIPANT PAGE

	$('#new_person_btn').click(function(){
		$("#person_list").append('<div class="person"><br><input class="person_name" placeholder="Name"></input><span id="remove_btn" class="glyphicon glyphicon-remove-sign" style="color:red;" aria-hidden="true"></span><br><br><div>');
		$("#person_list :last-child input").focus();
		});

	$(document).on('click', '#remove_btn', function(){
		$(this).parent().remove();
	});

	$('#done_btn').click(function(){
		if(!$('#restaurant_name').val()){
			alert("You forgot to input Restaurant name!");
		}else{
			$('.bodyBox').css('display','none');
			$('#addExpenseRecipt').css('display','block');
			$('#restaurant').html( $('#restaurant_name').val());

			//Alphabetize list
			var names = [];
			$("#person_list .person_name").each(function() {
				names.push($(this).val());
			})

			names.sort();

			$.each(names, function(i, val) {
				$('#participants_list').append('<div class="participants_list_name">'+ val +'</div>');
			})
		}
	})


	//PARTICIPANTS LIST PAGE

	$(document).on('click', '#add_participant', function(){
		if($("div#participants_list").css("visibility") == 'visible'){
			$("div#participants_list").css('visibility','hidden');
		}else{
			$("div#participants_list").css('visibility','visible');
		}

	});

	$("#add_participant").click(function(){		
	});

	$(document).on('click', '.participants_list_name', function(){
		$(this).toggleClass('select');
	});


 /******** Add Expense functions ********/

 	//add expense/cost/participants
			$("#add_btn").click(function(){
				$("#myTable").append(
					'<tr><td><input type="text" placeholder="Burger"></td>'
					+
					'<td><input type="number" class="price" placeholder="1.99" min="0" step="any" onchange="calculateAll()"></td>'
					+
					'<td><span class="glyphicon glyphicon-plus-sign" id="add_participant" style="color:green;" aria-hidden="true"></span>'
					+
					'<div id = "participants_list"></div>'
					//'<button class="delete_btn" type="button" onclick="deleteRow(this); calculateAll();">X</button>'
					+ 
					'<div class = "participants_selected"></div>'
					+
					'</td></tr>'
					);
			});

				$(document).on('click', '.participants_list_name.select', function(){
					
				});
		
			//Calculates all four rows of tfoot
			function calculateAll() {
				calculateSum();
				calculateTax();
				calculateTip();
				calculateGrandTotal();	
			}

			//Calculates the sum of tbody
			function calculateSum() {
				var sum=0;

				$(".price").each(function() {
					var value = $(this).val();
					if (!isNaN(value) && value.length !=0) {
						sum += parseFloat(value);
					}
				})
				sum = sum.toFixed(2);

				$('#total').text(sum);
			}

			//Takes the tax percent and multiplying it with total sum
			function calculateTax() {
				var result = $('#total').text();
				var tax = $('#taxPercent').val();

				var totalTax = result * (tax * 0.01);
				totalTax = totalTax.toFixed(2);

				$('#tax').text(totalTax);
			}

			//Takes the tip percent and multiplies it with the total sum
			function calculateTip() {
				var result = $('#total').text();
				var tip = $('#tipPercent').val();

				var totalTip = result * (tip * 0.01);
				totalTip = totalTip.toFixed(2);

				$('#tip').text(totalTip);
			}

			//Adds total sum, tax and tip to get grand total
			function calculateGrandTotal() {
				var result = parseFloat($('#total').text());
				var tax = parseFloat($('#tax').text());
				var tip = parseFloat($('#tip').text());

				var total = result + tax + tip;
				total = '$' + total.toFixed(2);

				$('#grandTotal').text(total);
			}

			function deleteRow(element) {
				var row = element.parentNode.parentNode;
				row.parentNode.removeChild(row);
				calculateAll();
			}



	</script>
</body>
</html>